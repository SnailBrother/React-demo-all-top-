CREATE TABLE reactDemoApp.dbo.userAccounts (
    id INT IDENTITY(1,1) PRIMARY KEY,         -- 用户ID，自增
    username NVARCHAR(100) NOT NULL,          -- 用户姓名
    email NVARCHAR(100) NOT NULL UNIQUE,       -- 用户邮箱，唯一
    password NVARCHAR(255) NOT NULL,           -- 用户密码，存储加密后的密码
    registration_date DATETIME DEFAULT GETDATE(),  -- 用户注册时间，默认为当前时间
    last_login_time DATETIME DEFAULT GETDATE(),                  -- 最后登录时间
    profile_picture NVARCHAR(255),             -- 头像图片链接
    permission_level NVARCHAR(50) DEFAULT 0,    -- 权限级别，例如管理员、普通用户、VIP等 
    notes NVARCHAR(500),                      -- 管理员备注信息
    is_locked BIT DEFAULT 0,                    -- 账户锁定状态，默认为0（未锁定）
);


CREATE TABLE reactDemoApp.dbo.UserThemeSettings (
    id INT IDENTITY(1,1) PRIMARY KEY,
    
    email NVARCHAR(100) NOT NULL,

    theme_name NVARCHAR(100) DEFAULT '默认主题',
    
    -- ===== 背景色 =====
    background_color NVARCHAR(9) DEFAULT '#FFFFFFFF',           -- 背景色
    secondary_background_color NVARCHAR(9) DEFAULT '#F8F9FAFF', -- 次要背景色
    hover_background_color NVARCHAR(9) DEFAULT '#E9ECEEFF',     -- 悬停背景色
    focus_background_color NVARCHAR(9) DEFAULT '#DEE2E6FF',     -- 焦点背景色
    
    -- ===== 字体颜色 =====
    font_color NVARCHAR(9) DEFAULT '#000000FF',                -- 主要字体颜色
    secondary_font_color NVARCHAR(9) DEFAULT '#6C757DFF',      -- 次要字体颜色
    hover_font_color NVARCHAR(9) DEFAULT '#0078D4FF',          -- 悬停字体颜色
    focus_font_color NVARCHAR(9) DEFAULT '#0056B3FF',          -- 焦点字体颜色
    watermark_font_color NVARCHAR(9) DEFAULT '#B3B5B6FF',      -- 水印字体颜色
    font_family NVARCHAR(255) DEFAULT 'system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif', -- 字体族
    
    -- ===== 边框颜色 =====
    border_color NVARCHAR(9) DEFAULT '#DEE2E6FF',              -- 主要边框颜色
    secondary_border_color NVARCHAR(9) DEFAULT '#E9ECEEFF',    -- 次要边框颜色
    hover_border_color NVARCHAR(9) DEFAULT '#0078D4FF',        -- 悬停边框颜色
    focus_border_color NVARCHAR(9) DEFAULT '#0056B3FF',        -- 焦点边框颜色
    
    -- ===== 阴影颜色 =====
    shadow_color NVARCHAR(9) DEFAULT '#00000019',              -- 阴影颜色
    hover_shadow_color NVARCHAR(9) DEFAULT '#00000026',        -- 悬停阴影颜色
    focus_shadow_color NVARCHAR(9) DEFAULT '#0078D440',        -- 焦点阴影颜色

    is_active BIT DEFAULT 0,        -- 默认不启用激活

    background_animation NVARCHAR(100) DEFAULT 'DarkClouds',  -- 背景特效
 
    -- 外键约束：关联到 userAccounts 表的 email 字段
    FOREIGN KEY (email) REFERENCES reactDemoApp.dbo.userAccounts(email) 
        ON DELETE CASCADE, -- 外键约束    如果用户被删除，相关的主题设置也删除  
);

 CONSTRAINT UK_UserTheme_Username UNIQUE (username, theme_name)   -- 确保每个用户的主题名称是唯一的，不能重复
新增加一个 backgroundAnimation VARCHAR(100) DEFAULT 'WaterWave'  背景特效




const express = require('express');
const cors = require('cors');
const sql = require('mssql');
const xlsx = require('xlsx');
const app = express();
const port = 4200;


// SQL Server 配置
const config = {
    user: 'sa',
    password: 'Alan944926',
    server: '111.231.79.183',
    database: 'reactDemoApp',
    options: {
        encrypt: false,
        trustServerCertificate: true,
        pool: {
            max: 100, // 连接池最大连接数
            min: 0,  // 最小连接数
            idleTimeoutMillis: 30000 // 空闲连接超时时间
        }

    }
};

  const response = await fetch('http://111.231.79.183:4200/api/getUserAccounts');

// 获取 userAccounts 表数据
app.get('/api/getUserAccounts', async (req, res) => {
    try {
        let firstpool = await sql.connect(config);
        let accountLoginResult = await firstpool.request().query('SELECT * FROM reactDemoApp.dbo.userAccounts');
        res.json({ AccountLogin: accountLoginResult.recordset });
        firstpool.close();
    } catch (err) {
        console.error(err);
        res.status(500).send('Server Error');
    }
});


//衣柜数据库  
CREATE TABLE reactDemoApp.dbo.ReactDemoWardrobeStewardData (
    id INT IDENTITY(1,1) PRIMARY KEY,   -- 唯一ID
    username NVARCHAR(100) NOT NULL,    -- 用户姓名
    email NVARCHAR(100) NOT NULL,       -- 用户邮箱

    item_code NVARCHAR(20) UNIQUE,       -- 服装编码，保证唯一性
    season NVARCHAR(20) NOT NULL,        -- 季节性标签 (夏季、冬季、四季)
    category NVARCHAR(50) NOT NULL,      -- 类别 (如衣服、裤子、连衣裙、鞋子、配饰)
    sub_category NVARCHAR(50) NOT NULL,  -- 子类别 (如基础款、外套类、裤装、裙装等)
    item_name NVARCHAR(100) NOT NULL,    -- 服装名称 (如背心、短裤等,可以自己输入，可以选择输入)
    
    created_at DATETIME DEFAULT GETDATE(), -- 创建时间
    updated_at DATETIME DEFAULT GETDATE() -- 更新时间
    
);


//歌曲
CREATE TABLE ChatApp.dbo.Music (
    id INT IDENTITY(1,1) PRIMARY KEY,       -- 自增 ID 作为主键
    title NVARCHAR(255) NOT NULL,            -- 音乐标题，最大字符数 255
    artist NVARCHAR(255) NOT NULL,           -- 艺术家/歌手，最大字符数 255
    coverimage NVARCHAR(255),                -- 封面图像路径，最大字符数 255
    src NVARCHAR(255) NOT NULL              -- 音乐文件源路径，最大字符数 255
    genre NVARCHAR(50)                      -- 歌曲类型（欧美、华语、韩语、其他等），最大字符数 50
);

CREATE TABLE reactDemoApp.dbo.UserMusicFavorites (
    id INT IDENTITY(1,1) PRIMARY KEY,       -- 唯一ID
    email NVARCHAR(100) NOT NULL,       -- 用户邮箱
    title NVARCHAR(255) NOT NULL,            -- 音乐标题，最大字符数 255
    artist NVARCHAR(255) NOT NULL,           -- 艺术家/歌手，最大字符数 255
    genre NVARCHAR(50),                   -- 歌曲类型（欧美、华语、韩语、其他等），最大字符数 50
    playcount INT NOT NULL                   -- Number of times the song has been played
     
);

CREATE TABLE ChatApp.dbo.RecentlyPlayedMusic (
    id INT IDENTITY(1,1) PRIMARY KEY,        --  
    email NVARCHAR(100) NOT NULL,       -- 用户邮箱
    title NVARCHAR(255) NOT NULL,            -- 音乐标题，最大字符数 255
    artist NVARCHAR(255) NOT NULL,           -- 艺术家/歌手，最大字符数 255
    coverimage NVARCHAR(255),                -- 封面图像路径，最大字符数 255
    src NVARCHAR(255) NOT NULL,              -- 音乐文件源路径，最大字符数 255
    genre NVARCHAR(50),                      -- 歌曲类型（欧美、华语、韩语、其他等），最大字符数 50
    playtime DATETIME DEFAULT GETDATE()      -- 默认当前时间
);

CREATE TABLE ChatApp.dbo.MusicComments (
    comment_id INT IDENTITY(1,1) PRIMARY KEY,  -- 自增 ID 作为主键
    music_id INT NOT NULL,                      -- 音乐 ID，外键引用 Music 表的 id
    user_name NVARCHAR(255) NOT NULL,           -- 评论的用户名称
    music_title NVARCHAR(255) NOT NULL,            -- 音乐标题，最大字符数 255
    music_artist NVARCHAR(255) NOT NULL,           -- 艺术家/歌手，最大字符数 255
    comment_text NVARCHAR(1000) NOT NULL,       -- 评论内容，最大字符数 1000
    created_at DATETIME DEFAULT GETDATE(),     -- 评论时间，默认当前时间
    FOREIGN KEY (music_id) REFERENCES ChatApp.dbo.Music(id) 
    ON DELETE CASCADE                           -- 当 Music 表中的歌曲删除时，删除该歌曲的评论
);



-- 一起听歌 REACTDEMO 音乐房间表
CREATE TABLE reactDemoApp.dbo.ListenMusicTogetherMusicRooms (
    id INT IDENTITY(1,1) PRIMARY KEY,          -- 房间ID，主键，自增长
    room_name NVARCHAR(100) UNIQUE,         -- 房间名称，必须唯一
    password NVARCHAR(100),                          -- 房间密码，若有则设置密码
    host NVARCHAR(100) NOT NULL,                     -- 房主（创建者）名称 
    max_users INT NOT NULL DEFAULT 10,               -- 房间的最大用户数，默认为10
    title NVARCHAR(255) NOT NULL DEFAULT 'Hurt',            -- 音乐标题，最大字符数 255
    artist NVARCHAR(255) NOT NULL DEFAULT 'Johnny Cash',           -- 艺术家/歌手，最大字符数 255
    coverimage NVARCHAR(255) NOT NULL DEFAULT 'Hurt-Johnny Cash.jpg',                -- 封面图像路径，最大字符数 255
    src NVARCHAR(255)  NOT NULL DEFAULT 'Hurt-Johnny Cash.mp3',              -- 音乐文件源路径，最大字符数 255
    genre NVARCHAR(50) NOT NULL DEFAULT '欧美',                      -- 歌曲类型（欧美、华语、韩语、其他等），最大字符数 50
    is_playing BIT DEFAULT 0,                        -- 当前是否正在播放，0 表示不在播放，1 表示正在播放
    play_mode NVARCHAR(50) DEFAULT 'order',        -- 播放模式，默认值为 '顺序播放'
    created_at DATETIME NOT NULL DEFAULT GETDATE(),   -- 房间创建时间，默认当前时间
     [current_time] FLOAT DEFAULT 0,                  -- 当前播放的时间点，单位为秒，默认值为0
  room_status NVARCHAR(50) NOT NULL DEFAULT '等待中', -- 房间状态，默认值为 '等待中'，表示房间当前状态（例如：等待中、进行中等）
);



-- 一起听歌 REACTDEMO  房间用户表
CREATE TABLE reactDemoApp.dbo.ListenMusicTogetherMusicRoomUsers (
    id INT IDENTITY(1,1) PRIMARY KEY,
    room_name NVARCHAR(100) NOT NULL,   -- 房间名称 
    email NVARCHAR(100) NOT NULL,       -- 用户邮箱
    is_host BIT NOT NULL DEFAULT 0,      -- 是否是房主
    join_time DATETIME NOT NULL DEFAULT GETDATE(),  -- 加入时间
    CONSTRAINT UQ_MusicRoomUsers_RoomUser UNIQUE (room_name, email),
    FOREIGN KEY (room_name) REFERENCES reactDemoApp.dbo.ListenMusicTogetherMusicRooms(room_name) ON DELETE CASCADE    -- 外键约束
);

-- 一起听歌  房间消息表
CREATE TABLE ChatApp.dbo.MusicRoomMessages (
    id INT IDENTITY(1,1) PRIMARY KEY,               -- 消息ID，主键，自增长
    room_name NVARCHAR(100) NOT NULL,                -- 房间名称，外键，关联 MusicRooms 表的 room_name 字段
    email NVARCHAR(100) NOT NULL,       -- 用户邮箱
    message NVARCHAR(1000) NOT NULL,                 -- 消息内容，最大长度为 1000 字符
    sent_at DATETIME NOT NULL DEFAULT GETDATE(),     -- 消息发送时间，默认当前时间
    FOREIGN KEY (room_name) REFERENCES reactDemoApp.dbo.ListenMusicTogetherMusicRooms(room_name) 
        ON DELETE CASCADE                            -- 外键约束，删除 reactDemoApp.dbo.ListenMusicTogetherMusicRooms 中的房间时，自动删除该房间的所有消息
);